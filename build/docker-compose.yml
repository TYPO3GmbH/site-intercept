networks:
  default:
    external: true
    name: ddev_default
services:
  blackfire:
    container_name: ddev-intercept-blackfire
    environment:
      BLACKFIRE_SERVER_ID: 8f3cb7a0-5315-445d-b1a8-773fdfb590f9
      BLACKFIRE_SERVER_TOKEN: b2c5d0d1426c56154cd41a79a647659b1f99bdedfc0481ac4965421a772fc89f
    image: blackfire/blackfire
    ports:
    - target: 8707
  db:
    build:
      args:
        BASE_IMAGE: drud/ddev-dbserver-mariadb-10.2:v1.17.7
        gid: '1000'
        uid: '1000'
        username: susan
      context: /home/susan/projects/site-intercept/.ddev/db-build
      dockerfile: ../.dbimageBuild/Dockerfile
    command: ''
    container_name: ddev-intercept-db
    environment:
      COLUMNS: '207'
      DDEV_HOSTNAME: intercept.ddev.site
      DDEV_PHP_VERSION: '7.4'
      DDEV_PRIMARY_URL: https://intercept.ddev.site
      DDEV_PROJECT: intercept
      DDEV_PROJECT_TYPE: php
      DDEV_ROUTER_HTTPS_PORT: '443'
      DDEV_ROUTER_HTTP_PORT: '80'
      DDEV_SITENAME: intercept
      DDEV_TLD: ddev.site
      DOCKER_IP: 127.0.0.1
      HOST_DOCKER_INTERNAL_IP: ''
      IS_DDEV_PROJECT: "true"
      LINES: '42'
      TZ: ''
    healthcheck:
      interval: 1s
      retries: 120
      start_period: 2m
      timeout: 2m
    hostname: intercept-db
    image: drud/ddev-dbserver-mariadb-10.2:v1.17.7-intercept-built
    labels:
      com.ddev.app-type: php
      com.ddev.approot: /home/susan/projects/site-intercept
      com.ddev.platform: ddev
      com.ddev.site-name: intercept
    ports:
    - 127.0.0.1:60761:3306/tcp
    restart: "no"
    stop_grace_period: 60s
    user: 1000:1000
    volumes:
    - ddev-global-cache:/mnt/ddev-global-cache:rw
    - source: /home/susan/projects/site-intercept/.ddev
      target: /mnt/ddev_config
      type: bind
    - source: mariadb-database
      target: /var/lib/mysql
      type: volume
      volume:
        nocopy: true
  graylog:
    build:
      context: /home/susan/projects/site-intercept/.ddev/graylog/build
    container_name: ddev-intercept-graylog
    depends_on:
      graylogelastic:
        condition: service_started
      graylogmongo:
        condition: service_started
    environment:
      GRAYLOG_PASSWORD_SECRET: ULwrllyZMmhispiUyyTHTcicRK76YumjXfsNX3YIClWU4oRjLUPGzPyH83rddOCDxeekUWBfvsPgSjW0txbPO5QTWQpPGycj
      GRAYLOG_ROOT_PASSWORD_SHA2: 2c26b46b68ffc68ff99b453c1d30413413422d706483bfa0f98a5e886266e7ae
      GRAYLOG_WEB_ENDPOINT_URI: http://intercept.ddev.site:9101/api
      HTTP_EXPOSE: 9101:9000
      VIRTUAL_HOST: intercept.ddev.site
    labels:
      com.ddev.site-name: intercept
    links:
    - graylogelastic:elasticsearch
    - graylogmongo:mongo
    ports:
    - target: 514
    - protocol: udp
      target: 514
    - protocol: udp
      target: 4201
    - protocol: udp
      target: 4202
    - target: 9000
    - protocol: udp
      target: 12201
    - target: 12202
    volumes:
    - graylogdata:/opt/graylog/data:rw
  graylogelastic:
    build:
      context: /home/susan/projects/site-intercept/.ddev/graylogelastic/build
    container_name: ddev-intercept-graylogelastic
    environment:
      ES_JAVA_OPTS: -Xms2g -Xmx2g
      bootstrap.memory_lock: "true"
      cluster.name: docker-cluster
    labels:
      com.ddev.site-name: intercept
    ports:
    - target: 9200
    ulimits:
      memlock:
        hard: -1
        soft: -1
    volumes:
    - graylogelasticdata:/usr/share/elasticsearch/data:rw
  graylogmongo:
    container_name: ddev-intercept-graylogmongo
    image: mongo:3
    labels:
      com.ddev.site-name: intercept
    ports:
    - target: 27017
    volumes:
    - graylogmongoconfig:/data/configdb:rw
    - graylogmongodata:/data/db:rw
  keycloak-gatekeeper:
    command:
    - /keycloak-gatekeeper
    - --config=/mnt/ddev_config/keycloak-gatekeeper.conf
    image: bitnami/keycloak-gatekeeper:10-scratch
    ports:
    - published: 3007
      target: 3007
    volumes:
    - source: /home/susan/projects/site-intercept/.ddev
      target: /mnt/ddev_config
      type: bind
  rabbitmq:
    container_name: ddev-intercept-rabbitmq
    environment:
      HTTP_EXPOSE: '15672'
      VIRTUAL_HOST: intercept.ddev.site
    image: rabbitmq:3.7-management
    labels:
      com.ddev.app-url: https://intercept.ddev.site
      com.ddev.approot: /home/susan/projects/site-intercept
      com.ddev.site-name: intercept
    ports:
    - target: 5672
    - target: 15672
    volumes:
    - /home/susan/projects/site-intercept/.ddev/rabbitmq/rabbitmq.conf:/etc/rabbitmq/rabbitmq.conf:rw
  web:
    build:
      args:
        BASE_IMAGE: drud/ddev-webserver:v1.17.7
        gid: '1000'
        uid: '1000'
        username: susan
      context: /home/susan/projects/site-intercept/.ddev/web-build
      dockerfile: ../.webimageBuild/Dockerfile
    cap_add:
    - SYS_PTRACE
    container_name: ddev-intercept-web
    environment:
      COLUMNS: '207'
      DDEV_DOCROOT: public
      DDEV_FILES_DIR: /var/www/html/public
      DDEV_HOSTNAME: intercept.ddev.site
      DDEV_PHP_VERSION: '7.4'
      DDEV_PRIMARY_URL: https://intercept.ddev.site
      DDEV_PROJECT: intercept
      DDEV_PROJECT_TYPE: php
      DDEV_ROUTER_HTTPS_PORT: '443'
      DDEV_ROUTER_HTTP_PORT: '80'
      DDEV_SITENAME: intercept
      DDEV_TLD: ddev.site
      DDEV_WEBSERVER_TYPE: nginx-fpm
      DDEV_XDEBUG_ENABLED: "false"
      DEPLOY_NAME: local
      DOCKER_IP: 127.0.0.1
      DOCROOT: public
      DRUSH_ALLOW_XDEBUG: '1'
      DRUSH_OPTIONS_URI: https://intercept.ddev.site
      HOST_DOCKER_INTERNAL_IP: ''
      HTTPS_EXPOSE: 443:80,8026:8025
      HTTP_EXPOSE: 80:80,8025:8025
      IS_DDEV_PROJECT: "true"
      LINES: '42'
      PHP_IDE_CONFIG: serverName=intercept.ddev.site
      SSH_AUTH_SOCK: /home/.ssh-agent/socket
      TZ: ''
      VIRTUAL_HOST: intercept.ddev.site
    external_links:
    - ddev-router:intercept.ddev.site
    healthcheck:
      interval: 1s
      retries: 120
      start_period: 2m
      timeout: 2m
    hostname: intercept-web
    image: drud/ddev-webserver:v1.17.7-intercept-built
    labels:
      com.ddev.app-type: php
      com.ddev.approot: /home/susan/projects/site-intercept
      com.ddev.platform: ddev
      com.ddev.site-name: intercept
    links:
    - db
    - rabbitmq:intercept.ddev.site
    ports:
    - published: 9930
      target: 22
    restart: "no"
    user: 1000:1000
    volumes:
    - /home/susan/projects/site-intercept/.ddev/apache:/etc/apache2/sites-enabled:ro
    - /home/susan/projects/site-intercept/.ddev/nginx_full:/etc/nginx/sites-enabled:ro
    - ddev-ssh-agent_socket_dir:/home/.ssh-agent:rw
    - ddev-global-cache:/mnt/ddev-global-cache:rw
    - /home/susan/projects/site-intercept/.ddev:/mnt/ddev_config:ro
    - consistency: cached
      source: /home/susan/projects/site-intercept
      target: /var/www/html
      type: bind
version: '3.6'
volumes:
  ddev-global-cache:
    name: ddev-global-cache
  ddev-ssh-agent_socket_dir:
    external: true
    name: ddev-ssh-agent_socket_dir
  graylogdata:
    driver: local
  graylogelasticdata:
    driver: local
  graylogmongoconfig:
    driver: local
  graylogmongodata:
    driver: local
  mariadb-database:
    name: intercept-mariadb
