# Global redirect rules
# This configuration file contains global redirects for the documentation server
# It is deployed automatic into the nginx of the documentation server.
# This file is included in the VHost configuration and can contain any kind of redirect rules.
#
# WARNING: THIS FILE IS DIRECTLY DEPLOYED TO DOCS LIVE SERVER WHEN INTERCEPT PATCHES
#          ARE MERGED TO DEVELOP BRANCH. SYNTAX ERRORS WILL LEAD TO DOCS.TYPO3.ORG BEING DOWN!
#
# Example:
# location ~ ^/typo3cms/ViewHelperReference(.*)$ {
#    return 303 /other/typo3/ViewHelperReference/9.5/en-us$1;
#}

# Redirect master to main
location ~ (.*)/master/(.*)$ {
    return 303 $1/main/$2;
}

# Redirect minor versions to their LTS cuonterpart
location ~ ^/c/typo3/([^/]+)/11.[0-4]/(.*)$ {
    return 303 /c/typo3/$1/11.5/$2;
}

location ~ ^/c/typo3/([^/]+)/12.[0-3]/(.*)$ {
    return 303 /c/typo3/$1/12.4/$2;
}

location ~ ^/c/typo3/([^/]+)/13.[0-3]/(.*)$ {
    return 303 /c/typo3/$1/13.4/$2;
}

# Add short links
location = /installation {
    return 303 /permalink/t3coreapi:installation-index;
}

location = /upgrade {
    return 303 /permalink/t3coreapi:upgrading;
}

location = /system-requirements {
    return 303 /permalink/t3coreapi:system-requirements;
}

location = /core-contribution {
    return 303 /permalink/t3contribute:recommended-reading;
}

# Rewrite Upgrade guide links to new position in TYPO3 explained
location ~ ^/m/typo3/guide-installation/(main|13.4|12.4)/en-us/(.*)$ {
    return 301 /m/typo3/reference-coreapi/$1/en-us/Administration/Upgrade/$2;
}

# Rewrite TypoScript in 45 min guide links to new position in TypoScript reference
location ~ ^/m/typo3/tutorial-typoscript-in-45-minutes/(main|13.4|12.4)/en-us/(.*)$ {
    return 301 /m/typo3/reference-typoscript/$1/en-us/Guide/$2;
}

# Move Installation chapter
location ~ ^/m/typo3/reference-coreapi/(main|13.4|12.4)/en-us/Administration/Installation/Install.html$ {
    return 301 /m/typo3/reference-coreapi/$1/en-us/Administration/Installation/Index.html;
}

# Move TypoScript Syntax into TypoScript reference
location ~ ^/m/typo3/reference-coreapi/(main|13.4|12.4)/en-us/Configuration/TypoScript/Syntax/(.*)/Index.html$ {
    return 301 /m/typo3/reference-typoscript/$1/en-us/Syntax/$2/Index.html;
}

# Move HMENU special properties into data processor
location ~ ^/m/typo3/reference-coreapi/(main|13.4)/en-us/Configuration/TypoScript/Syntax/(?!Tmenu)(.*)$ {
    return 301 /m/typo3/reference-typoscript/$1/en-us/DataProcessing/MenuProcessor/$2;
}

# Rewrite Fluid VH reference links to new position
location ~ ^/typo3cms/ViewHelperReference/latest(.*)$ {
    return 301 /other/typo3/view-helper-reference/main/en-us$1;
}
location ~ ^/typo3cms/ViewHelperReference(.*)$ {
    return 301 /other/typo3/view-helper-reference/main/en-us$1;
}

# Redirect from 1.0 to main in how to document
location ~ ^/m/typo3/docs-how-to-document/1.0/en-us/(.*) {
    return 301 /m/typo3/docs-how-to-document/main/en-us/$1;
}

# Redirect from old rest reference to new
location ~ ^/m/typo3/docs-how-to-document/main/en-us/WritingReST/Reference/(.*) {
    return 301 /m/typo3/docs-how-to-document/main/en-us/Reference/ReStructuredText/$1;
}

# Redirect URLs of old ViewHelper reference to new ViewHelper reference for 12.4 and main
# (11 and below are static)
location ~ ^/other/typo3/view-helper-reference/(main|12.4)/en-us/typo3/backend/latest/(.*) {
    return 301 /other/typo3/view-helper-reference/$1/en-us/Backend/$2;
}
location ~ ^/other/typo3/view-helper-reference/(main|12.4)/en-us/typo3/core/latest/(.*) {
    return 301 /other/typo3/view-helper-reference/$1/en-us/Core/$2;
}
location ~ ^/other/typo3/view-helper-reference/(main|12.4)/en-us/(?:typo3fluid/fluid|typo3/fluid)/latest/(.*) {
    return 301 /other/typo3/view-helper-reference/$1/en-us/Global/$2;
}

# Move exceptions to standard location
location ~ ^/typo3cms/exceptions/main/en-us/(.*)$ {
    return 301 /m/typo3/reference-exceptions/main/en-us/$1;
}

# Rewrite Surf documentation links to new position
location ~ ^/surf/latest(.*)$ {
    return 301 /other/typo3/surf/main/en-us$1;
}
location ~ ^/surf(.*)$ {
    return 301 /other/typo3/surf/main/en-us$1;
}

# typo3/reference-tca
# properties of moved into index

location ~ ^/m/typo3/reference-tca/(main|12.4)/en-us/ColumnsConfig/Type/([^/]+)/Properties/.*$ {
    return 303 /m/typo3/reference-tca/$1/en-us/ColumnsConfig/Type/$2/Index.html;
}
location ~ ^/m/typo3/reference-tca/(main|12.4)/en-us/Ctrl/Properties/.*$ {
    return 303 /m/typo3/reference-tca/$1/en-us/Ctrl/Index.html;
}

# typo3/reference-coreapi
# redirects for moved sections



location ~ ^/m/typo3/reference-coreapi/(main|13.4)/en-us/ApiOverview/DatabaseRecords/Index.html$ {
    return 303 /m/typo3/reference-coreapi/$1/en-us/ApiOverview/Database/DatabaseRecords/Index.html;
}

location ~ ^/m/typo3/reference-coreapi/(main|13.4)/en-us/ApiOverview/DatabaseRecords/RecordObjects.html$ {
    return 303 /m/typo3/reference-coreapi/$1/en-us/ApiOverview/Database/DatabaseRecords/RecordObjects.html;
}

location ~ ^/m/typo3/reference-coreapi/(main|13.4)/en-us/ApiOverview/Database/BasicCrud/Index.html$ {
    return 303 /m/typo3/reference-coreapi/$1/en-us/ApiOverview/Database/DoctrineDbal/BasicCrud/Index.html;
}

location ~ ^/m/typo3/reference-coreapi/(main|13.4)/en-us/ApiOverview/Database/ClassOverview/Index.html$ {
    return 303 /m/typo3/reference-coreapi/$1/en-us/ApiOverview/Database/DoctrineDbal/ClassOverview/Index.html;
}

location ~ ^/m/typo3/reference-coreapi/(main|13.4)/en-us/ApiOverview/Database/Configuration/Index.html$ {
    return 303 /m/typo3/reference-coreapi/$1/en-us/ApiOverview/Database/DoctrineDbal/Configuration/Index.html;
}

location ~ ^/m/typo3/reference-coreapi/(main|13.4)/en-us/ApiOverview/Database/Connection/Index.html$ {
    return 303 /m/typo3/reference-coreapi/$1/en-us/ApiOverview/Database/DoctrineDbal/Connection/Index.html;
}

location ~ ^/m/typo3/reference-coreapi/(main|13.4)/en-us/ApiOverview/Database/ConnectionPool/Index.html$ {
    return 303 /m/typo3/reference-coreapi/$1/en-us/ApiOverview/Database/DoctrineDbal/ConnectionPool/Index.html;
}

location ~ ^/m/typo3/reference-coreapi/(main|13.4)/en-us/ApiOverview/Database/ExpressionBuilder/Index.html$ {
    return 303 /m/typo3/reference-coreapi/$1/en-us/ApiOverview/Database/DoctrineDbal/ExpressionBuilder/Index.html;
}

location ~ ^/m/typo3/reference-coreapi/(main|13.4)/en-us/ApiOverview/Database/Introduction/Index.html$ {
    return 303 /m/typo3/reference-coreapi/$1/en-us/ApiOverview/Database/DoctrineDbal/Introduction/Index.html;
}

location ~ ^/m/typo3/reference-coreapi/(main|13.4)/en-us/ApiOverview/Database/Middleware/Index.html$ {
    return 303 /m/typo3/reference-coreapi/$1/en-us/ApiOverview/Database/DoctrineDbal/Middleware/Index.html;
}

location ~ ^/m/typo3/reference-coreapi/(main|13.4)/en-us/ApiOverview/Database/QueryBuilder/Index.html$ {
    return 303 /m/typo3/reference-coreapi/$1/en-us/ApiOverview/Database/DoctrineDbal/QueryBuilder/Index.html;
}

location ~ ^/m/typo3/reference-coreapi/(main|13.4)/en-us/ApiOverview/Database/RestrictionBuilder/Index.html$ {
    return 303 /m/typo3/reference-coreapi/$1/en-us/ApiOverview/Database/DoctrineDbal/RestrictionBuilder/Index.html;
}

location ~ ^/m/typo3/reference-coreapi/(main|13.4)/en-us/ApiOverview/Database/Statement/Index.html$ {
    return 303 /m/typo3/reference-coreapi/$1/en-us/ApiOverview/Database/DoctrineDbal/Statement/Index.html;
}

location ~ ^/m/typo3/reference-coreapi/(main|13.4)/en-us/ApiOverview/Database/TipsAndTricks/Index.html$ {
    return 303 /m/typo3/reference-coreapi/$1/en-us/ApiOverview/Database/DoctrineDbal/TipsAndTricks/Index.html;
}

location ~ ^/m/typo3/reference-coreapi/(main|13.4)/en-us/ApiOverview/Database/Troubleshooting/Index.html$ {
    return 303 /m/typo3/reference-coreapi/$1/en-us/ApiOverview/Database/DoctrineDbal/Troubleshooting/Index.html;
}

location ~ ^/m/typo3/reference-coreapi/(main|13.4|12.4)/en-us/ExtensionArchitecture/Extbase/Reference/Domain/Model.html {
    return 303 /m/typo3/reference-coreapi/$1/en-us/ExtensionArchitecture/Extbase/Reference/Domain/Model/Index.html;
}
location ~ ^/m/typo3/reference-coreapi/(main|13.4|12.4)/en-us/ExtensionArchitecture/Extbase/Reference/Domain/Repository.html {
    return 303 /m/typo3/reference-coreapi/$1/en-us/ExtensionArchitecture/Extbase/Reference/Domain/Repository/Index.html;
}
location ~ ^/m/typo3/reference-coreapi/(main|13.4|12.4)/en-us/ExtensionArchitecture/Extbase/Reference/Domain/Persistence.html {
    return 303 /m/typo3/reference-coreapi/$1/en-us/ExtensionArchitecture/Extbase/Reference/Domain/Persistence/Index.html;
}

location ~ ^/m/typo3/reference-coreapi/(main|13.4)/en-us/CodingGuidelines/PhpArchitecture/(.*) {
    return 303 /m/typo3/reference-coreapi/$1/en-us/PhpArchitecture/$2;
}

location ~ ^/m/typo3/reference-coreapi/(main|13.4)/en-us/CodingGuidelines/PhpArchitecture/(.*) {
    return 303 /m/typo3/reference-coreapi/$1/en-usCodingGuidelines/CodingBestPractices/$2;
}

location ~ ^/m/typo3/reference-coreapi/(main|11.5)/en-us/ApiOverview/LinkBrowser(.*) {
    return 303 /m/typo3/reference-coreapi/$1/en-us/ApiOverview/LinkHandling$2;
}

location ~ ^/m/typo3/reference-coreapi/(main|11.5)/en-us/ApiOverview/Internationalization(.*) {
    return 303 /m/typo3/reference-coreapi/$1/en-us/ApiOverview/Localization$2;
}
location ~ ^/m/typo3/reference-coreapi/main/en-us/ApiOverview/JavaScript(.*) {
    return 303 /m/typo3/reference-coreapi/main/en-us/ApiOverview/Backend/JavaScript$1;
}
location ~ ^/m/typo3/reference-coreapi/(main|11.5)/en-us/ApiOverview/AccessControl(.*) {
    return 303 /m/typo3/reference-coreapi/$1/en-us/ApiOverview/Backend/AccessControl$2;
}
location ~ ^/m/typo3/reference-coreapi/(main|11.5)/en-us/ApiOverview/BroadcastChannels(.*) {
    return 303 /m/typo3/reference-coreapi/$1/en-us/ApiOverview/Backend/BroadcastChannels$2;
}
location ~ ^/m/typo3/reference-coreapi/(main|11.5)/en-us/ApiOverview/ExtensionScanner/Index.html {
    return 303 /m/typo3/reference-coreapi/$1/en-us/ExtensionArchitecture/HowTo/UpdateExtensions/ExtensionScanner.html;
}
location ~ ^/m/typo3/reference-coreapi/(main|11.5)/en-us/ApiOverview/ExtensionScanner(.*) {
    return 303 /m/typo3/reference-coreapi/$1/en-us/ExtensionArchitecture/HowTo/UpdateExtensions/ExtensionScanner$2;
}
location ~ ^/m/typo3/reference-coreapi/(main|11.5)/en-us/ApiOverview/UpdateWizards(.*) {
    return 303 /m/typo3/reference-coreapi/$1/en-us/ExtensionArchitecture/HowTo/UpdateExtensions/UpdateWizards$2;
}

location ~ ^/m/typo3/reference-coreapi/(main|11.5|10.4)/en-us/TypoScriptSyntax(.*) {
    return 303 /m/typo3/reference-typoscript/$1/en-us/Syntax$2;
}
location ~ ^/m/typo3/reference-coreapi/(main|11.5|10.4)/en-us/ApiOverview/Hooks(.*) {
    return 303 /m/typo3/reference-coreapi/$1/en-us/ApiOverview/Events$2;
}
location ~ ^/m/typo3/reference-coreapi/(main|11.5|10.4)/en-us/Events(.*) {
    return 303 /m/typo3/reference-coreapi/$1/en-us/ApiOverview/Events$2;
}

# typo3/reference-coreapi
location ~ ^/typo3cms/CoreApiReference/[^/]+(/.*)?$ {
    return 301 /m/typo3/reference-coreapi/main/en-us$1;
}

# Extension Development rewrite 2022 main

location ~ ^/m/typo3/reference-coreapi/main/en-us/ExtensionArchitecture/ExtensionKey/Index.html {
    return 303 /m/typo3/reference-coreapi/main/en-us/ExtensionArchitecture/BestPractises/ExtensionKey.html;
}
location ~ ^/m/typo3/reference-coreapi/main/en-us/ExtensionArchitecture/NamingConventions/Index.html {
    return 303 /m/typo3/reference-coreapi/main/en-us/ExtensionArchitecture/BestPractises/NamingConventions.html;
}
location ~ ^/m/typo3/reference-coreapi/main/en-us/ExtensionArchitecture/ConfigurationFiles/Index.html {
    return 303 /m/typo3/reference-coreapi/main/en-us/ExtensionArchitecture/BestPractises/ConfigurationFiles.html;
}
location ~ ^/m/typo3/reference-coreapi/main/en-us/ExtensionArchitecture/Resources/Index.html {
    return 303 /m/typo3/reference-coreapi/main/en-us/ExtensionArchitecture/Concepts/FurtherReading.html;
}
location ~ ^/m/typo3/reference-coreapi/main/en-us/ExtensionArchitecture/Introduction/Index.html {
    return 303 /m/typo3/reference-coreapi/main/en-us/ExtensionArchitecture/Concepts/Introduction.html;
}
location ~ ^/m/typo3/reference-coreapi/main/en-us/ExtensionArchitecture/SystemAndLocalExtensions/Index.html {
    return 303 /m/typo3/reference-coreapi/main/en-us/ExtensionArchitecture/Concepts/SystemAndLocalExtensions.html;
}
location ~ ^/m/typo3/reference-coreapi/main/en-us/ApiOverview/BackendModules/(.*) {
    return 303 /m/typo3/reference-coreapi/main/en-us/ExtensionArchitecture/HowTo/BackendModule/$1;
}
location ~ ^/m/typo3/reference-coreapi/main/en-us/ExtensionArchitecture/ExtendingTca/(.*) {
    return 303 /m/typo3/reference-coreapi/main/en-us/ExtensionArchitecture/HowTo/ExtendingTca/$1;
}
location ~ ^/m/typo3/reference-coreapi/main/en-us/ExtensionArchitecture/FrontendPlugin/(.*) {
    return 303 /m/typo3/reference-coreapi/main/en-us/ExtensionArchitecture/HowTo/FrontendPlugin/$1;
}
location ~ ^/m/typo3/reference-coreapi/main/en-us/ExtensionArchitecture/PublishExtension/ {
    return 303 /m/typo3/reference-coreapi/main/en-us/ExtensionArchitecture/HowTo/PublishExtension/;
}
location ~ ^/m/typo3/reference-coreapi/main/en-us/ExtensionArchitecture/CreateNewDistribution/Index.html {
    return 303 /m/typo3/reference-coreapi/main/en-us/ExtensionArchitecture/HowTo/CreateNewDistribution.html;
}
location ~ ^/m/typo3/reference-coreapi/main/en-us/ExtensionArchitecture/CreateNewExtension/Index.html {
    return 303 /m/typo3/reference-coreapi/main/en-us/ExtensionArchitecture/HowTo/CreateNewExtension.html;
}
location ~ ^/m/typo3/reference-coreapi/main/en-us/ExtensionArchitecture/CustomExtensionRepository/Index.html {
    return 303 /m/typo3/reference-coreapi/main/en-us/ExtensionArchitecture/HowTo/CustomExtensionRepository.html;
}
location ~ ^/m/typo3/reference-coreapi/main/en-us/ExtensionArchitecture/Documentation/Index.html {
    return 303 /m/typo3/reference-coreapi/main/en-us/ExtensionArchitecture/HowTo/Documentation.html;
}
location ~ ^/m/typo3/reference-coreapi/main/en-us/ExtensionArchitecture/ExtensionManagement/Index.html {
    return 303 /m/typo3/reference-coreapi/main/en-us/ExtensionArchitecture/HowTo/ExtensionManagement.html;
}

# Extension Development rewrite 2022 LTS 11.5

location ~ ^/m/typo3/reference-coreapi/11.5/en-us/ExtensionArchitecture/ExtensionKey/Index.html {
    return 303 /m/typo3/reference-coreapi/11.5/en-us/ExtensionArchitecture/BestPractises/ExtensionKey.html;
}
location ~ ^/m/typo3/reference-coreapi/11.5/en-us/ExtensionArchitecture/NamingConventions/Index.html {
    return 303 /m/typo3/reference-coreapi/11.5/en-us/ExtensionArchitecture/BestPractises/NamingConventions.html;
}
location ~ ^/m/typo3/reference-coreapi/11.5/en-us/ExtensionArchitecture/ConfigurationFiles/Index.html {
    return 303 /m/typo3/reference-coreapi/11.5/en-us/ExtensionArchitecture/BestPractises/ConfigurationFiles.html;
}
location ~ ^/m/typo3/reference-coreapi/11.5/en-us/ExtensionArchitecture/Resources/Index.html {
    return 303 /m/typo3/reference-coreapi/11.5/en-us/ExtensionArchitecture/Concepts/FurtherReading.html;
}
location ~ ^/m/typo3/reference-coreapi/11.5/en-us/ExtensionArchitecture/Introduction/Index.html {
    return 303 /m/typo3/reference-coreapi/11.5/en-us/ExtensionArchitecture/Concepts/Introduction.html;
}
location ~ ^/m/typo3/reference-coreapi/11.5/en-us/ExtensionArchitecture/SystemAndLocalExtensions/Index.html {
    return 303 /m/typo3/reference-coreapi/11.5/en-us/ExtensionArchitecture/Concepts/SystemAndLocalExtensions.html;
}
location ~ ^/m/typo3/reference-coreapi/11.5/en-us/ApiOverview/BackendModules/(.*) {
    return 303 /m/typo3/reference-coreapi/11.5/en-us/ExtensionArchitecture/HowTo/BackendModule/$1;
}
location ~ ^/m/typo3/reference-coreapi/11.5/en-us/ExtensionArchitecture/ExtendingTca/(.*) {
    return 303 /m/typo3/reference-coreapi/11.5/en-us/ExtensionArchitecture/HowTo/ExtendingTca/$1;
}
location ~ ^/m/typo3/reference-coreapi/11.5/en-us/ExtensionArchitecture/FrontendPlugin/(.*) {
    return 303 /m/typo3/reference-coreapi/11.5/en-us/ExtensionArchitecture/HowTo/FrontendPlugin/$1;
}
location ~ ^/m/typo3/reference-coreapi/11.5/en-us/ExtensionArchitecture/PublishExtension/ {
    return 303 /m/typo3/reference-coreapi/11.5/en-us/ExtensionArchitecture/HowTo/PublishExtension/;
}
location ~ ^/m/typo3/reference-coreapi/11.5/en-us/ExtensionArchitecture/CreateNewDistribution/Index.html {
    return 303 /m/typo3/reference-coreapi/11.5/en-us/ExtensionArchitecture/HowTo/CreateNewDistribution.html;
}
location ~ ^/m/typo3/reference-coreapi/11.5/en-us/ExtensionArchitecture/CreateNewExtension/Index.html {
    return 303 /m/typo3/reference-coreapi/11.5/en-us/ExtensionArchitecture/HowTo/CreateNewExtension.html;
}
location ~ ^/m/typo3/reference-coreapi/11.5/en-us/ExtensionArchitecture/CustomExtensionRepository/Index.html {
    return 303 /m/typo3/reference-coreapi/11.5/en-us/ExtensionArchitecture/HowTo/CustomExtensionRepository.html;
}
location ~ ^/m/typo3/reference-coreapi/11.5/en-us/ExtensionArchitecture/Documentation/Index.html {
    return 303 /m/typo3/reference-coreapi/11.5/en-us/ExtensionArchitecture/HowTo/Documentation.html;
}
location ~ ^/m/typo3/reference-coreapi/11.5/en-us/ExtensionArchitecture/ExtensionManagement/Index.html {
    return 303 /m/typo3/reference-coreapi/11.5/en-us/ExtensionArchitecture/HowTo/ExtensionManagement.html;
}

# typo3/guide-contributionworkflow
location ~ ^/typo3cms/ContributionWorkflowGuide/[^/]+(/.*)?$ {
    return 301 /m/typo3/guide-contributionworkflow/main/en-us$1;
}

# typo3/guide-installation
location ~ ^/typo3cms/InstallationGuide/[^/]+(/.*)?$ {
    return 301 /permalink/t3coreapi:installation-index;
}

# typo3/book-extbasefluid
location ~ ^/typo3cms/ExtbaseFluidBook/[^/]+(/.*)?$ {
    return 301 /permalink/t3coreapi:extension-development;
}

# typo3/reference-typoscript
location ~ ^/typo3cms/TyposcriptReference/[^/]+(/.*)?$ {
    return 301 /m/typo3/reference-typoscript/main/en-us$1;
}

# typo3/reference-tsconfig
location ~ ^/typo3cms/TSconfigReference/[^/]+(/.*)?$ {
    return 301 /permalink/t3tsref:typoscript-syntax-using-setting;
}

location ~ ^/m/typo3/reference-tsconfig/(main|13.4|12.4)/en-us/UsingSetting(.*) {
    return 303 /m/typo3/reference-typoscript/$1/en-us/UsingSettingTSconfig$2;
}
location ~ ^/m/typo3/reference-tsconfig/(main|13.4|12.4)/en-us(.*) {
    return 303 /m/typo3/reference-typoscript/$1/en-us$2;
}

# typo3/docs-how-to-document
location ~ ^/typo3cms/HowToDocument/[^/]+(/.*)?$ {
    return 301 /m/typo3/docs-how-to-document/main/en-us$2;
}

# typo3/tutorial-getting-started
location ~ ^/typo3cms/GettingStartedTutorial/[^/]+(/.*)?$ {
    return 301 /m/typo3/tutorial-getting-started/main/en-us$1;
}

# typo3/docs-guide-render-typo3-documentation
location ~ ^/typo3cms/RenderTYPO3DocumentationGuide/[^/]+(/.*)?$ {
    return 301 /m/typo3/docs-how-to-document/main/en-us/Index.html;
}

# typo3/tutorial-editors
location ~ ^/typo3cms/EditorsTutorial/[^/]+(/.*)?$ {
    return 301 /m/typo3/tutorial-editors/main/en-us$1;
}

# typo3/guide-frontendlocalization
location ~ ^/typo3cms/FrontendLocalizationGuide/[^/]+(/.*)?$ {
    return 301 /m/typo3/guide-frontendlocalization/main/en-us$1;
}

# typo3/reference-tca
location ~ ^/typo3cms/TCAReference/[^/]+(/.*)?$ {
    return 301 /m/typo3/reference-tca/main/en-us$1;
}

# typo3/tutorial-sitepackage
location ~ ^/typo3cms/SitePackageTutorial/[^/]+(/.*)?$ {
    return 301 /m/typo3/tutorial-sitepackage/main/en-us$1;
}

# typo3/guide-extbasefluid
location ~ ^/typo3cms/ExtbaseGuide/[^/]+(/.*)?$ {
    return 301 /permalink/t3coreapi:extension-development;
}

# typo3/tutorial-typoscript-in-45-minutes
location ~ ^/typo3cms/TyposcriptIn45MinutesTutorial/[^/]+(/.*)?$ {
    return 301 /m/typo3/reference-typoscript/main/en-us/Guide$1;
}

# typo3/tutorial-templating-with-fluid
# typo3/tutorial-templating
location ~ ^/typo3cms/TemplatingTutorial(.*) {
    return 301 /m/typo3/tutorial-sitepackage/main/en-us/Index.html;
}

# typo3/team-t3oteam
location ~ ^/typo3cms/Teams/T3oTeam/[^/]+(/.*)?$ {
    return 301 /m/typo3/team-t3oteam/main/en-us$1;
}

# typo3/guide-security
location ~ ^/typo3cms/SecurityGuide/[^/]+(/.*)?$ {
    return 301 /m/typo3/reference-coreapi/main/en-us/Security/$1;
}

# typo3/reference-inside
location ~ ^/typo3cms/InsideTypo3Reference/[^/]+(/.*)?$ {
    return 301 /m/typo3/reference-coreapi/main/en-us/Index.html;
}

# typo3/reference-coding-guidelines
location ~ ^/typo3cms/CodingGuidelinesReference/[^/]+(/.*)?$ {
    return 301 /permalink/t3coreapi:cgl;
}

# typo3/reference-typoscript-syntax
location ~ ^/typo3cms/TyposcriptSyntaxReference/[^/]+(/.*)?$ {
    return 301 /m/typo3/reference-typoscript/main/en-us/Syntax/Index.html;
}

# typo3/reference-services
location ~ ^/typo3cms/Typo3ServicesReference(.*) {
    return 301 /permalink/t3coreapi:services;
}

# typo3/reference-fal
location ~ ^/typo3cms/FileAbstractionLayerReference(.*) {
    return 303 /permalink/t3coreapi:fal-introduction;
}

# typo3/reference-skinning
location ~ ^/typo3cms/SkinningReference(.*) {
    return 301 /m/typo3/tutorial-sitepackage/main/en-us/Index.html;
}


# Redirects for system extensions:
# Redirect the super outdated locations to main

# typo3/cms-felogin
location ~ ^/typo3cms/extensions/felogin/[^/]+(/.*)?$ {
    return 301 /c/typo3/cms-felogin/main/en-us$1;
}

# typo3/cms-fluid-styled-content
location ~ ^/typo3cms/extensions/fluid_styled_content/[^/]+(/.*)?$ {
    return 301 /c/typo3/cms-fluid-styled-content/main/en-us$1;
}

# typo/cms-form
location ~ ^/typo3cms/extensions/form/[^/]+(/.*)?$ {
    return 301 /c/typo3/cms-form/main/en-us$1;
}

# typo3/cms-indexed-search
location ~ ^/typo3cms/extensions/indexed_search/[^/]+(/.*)?$ {
    return 301 /c/typo3/cms-indexed-search/main/en-us$1;
}

# typo3/cms-linkvalidator
location ~ ^/typo3cms/extensions/linkvalidator/[^/]+(/.*)?$ {
    return 301 /c/typo3/cms-linkvalidator/main/en-us$1;
}

# typo3/cms-recycler
location ~ ^/typo3cms/extensions/recycler/[^/]+(/.*)?$ {
    return 303 /c/typo3/cms-recycler/main/en-us$1;
}

# typo3/cms-rte-ckeditor
location ~ ^/typo3cms/extensions/rte_ckeditor/[^/]+(/.*)?$ {
    return 301 /c/typo3/cms-rte-ckeditor/main/en-us$1;
}

# typo3/cms-scheduler
location ~ ^/typo3cms/extensions/scheduler/[^/]+(/.*)?$ {
    return 301 /c/typo3/cms-scheduler/main/en-us$1;
}

# typo3/cms-workspaces
location ~ ^/typo3cms/extensions/workspaces/[^/]+(/.*)?$ {
    return 301 /c/typo3/cms-workspaces/main/en-us$1;
}

# typo3/cms-core - had only lastest version online on old server
location ~ ^/typo3cms/extensions/core/[^/]+(/.*)?$ {
    return 301 /c/typo3/cms-core/main/en-us$1;
}

# typo3/cms-css-styled-content
location ~ ^/typo3cms/extensions/css_styled_content/[^/]+(/.*)?$ {
    return 301 /c/typo3/cms-css-styled-content/8.7/en-us$1;
}

# Redirect for any version of the Changelog to main. We only support the main branch here
location ~ ^/c/typo3/cms-core/(?!main)([^/]+)/en-us(.*) {
    return 301 /c/typo3/cms-core/main/en-us$2;
}

# friendsoftypo3/adodb
location ~ ^typo3cms/extensions/adodb/[^/]+(/.*)?$ {
    return 301 /p/friendsoftypo3/adodb/main/en-us$1;
}

# friendsoftypo3/dbal
location ~ ^/typo3cms/extensions/dbal/[^/]+(/.*)?$ {
    return 301 /p/friendsoftypo3/dbal/main/en-us$1;
}

# friendsoftypo3/openid
location ~ ^/typo3cms/extensions/openid/[^/]+(/.*)?$ {
    return 301 /p/friendsoftypo3/openid/main/en-us$1;
}

# typo3/cms-rsaauth
location ~ ^/typo3cms/extensions/rsaauth/[^/]+(/.*)?$ {
    return 303 /c/typo3/cms-rsaauth/main/en-us$1;
}

# typo3/cms-rtehtmlarea
# Specific for "current" extension detail page in TER
location ~ ^/typo3cms/extensions/rtehtmlarea/[^/]+(/.*)?$ {
    return 301 /p/friendsoftypo3/rtehtmlarea/main/en-us$1;
}

# typo3/cms-saltedpasswords
location ~ ^/typo3cms/extensions/saltedpasswords/[^/]+(/.*)?$ {
    return 301 /c/typo3/cms-saltedpasswords/main/en-us$1;
}

# typo3/cms-sys-action
location ~ ^/typo3cms/extensions/sys_action/[^/]+(/.*)?$ {
    return 301 /c/typo3/cms-sys-action/main/en-us$1;
}

# typo3/cms-taskcenter
location ~ ^/typo3cms/extensions/taskcenter/[^/]+(/.*)?$ {
    return 301 /c/typo3/cms-taskcenter/main/en-us$1;
}

location ~ ^/typo3cms/extensions/feusersmap/[^/]+(/.*)?$ {
    return 301 /p/wsr/feusersmap/main/en-us$1;
}

location ~ ^/typo3cms/extensions/externalimport_tu/[^/]+(/.*) {
    return 301 /p/cobweb/externalimport_tut/main/en-us$1;
}

# getting started rewrite 2024
location ~ ^/m/typo3/tutorial-getting-started/(main|13.4|12.4)/en-us/Installation/TutorialDdev.html {
   return 303 https://docs.typo3.org/m/typo3/tutorial-getting-started/$1/en-us/Installation/Install.html;
}
location ~ ^/m/typo3/tutorial-getting-started/(main|13.4|12.4)/en-us/UserManagement/(.*) {
   return 303 https://docs.typo3.org/m/typo3/reference-coreapi/$1/en-us/Administration/UserManagement/$2;
}
location ~ ^/m/typo3/tutorial-getting-started/(main|13.4|12.4)/en-us/PermissionsManagement/(.*) {
   return 303 https://docs.typo3.org/m/typo3/reference-coreapi/$1/en-us/Administration/PermissionsManagement/$2;
}
location ~ ^/m/typo3/tutorial-getting-started/(main|13.4|12.4)/en-us/Installation/TuneTYPO3.html {
   return 301 https://docs.typo3.org//permalink/t3coreapi:opcache@$1;
}
location ~ ^/m/typo3/reference-coreapi/(main|13.4|12.4)/en-us/AAdministration/Installation/TuneTYPO3.html {
   return 301 https://docs.typo3.org//permalink/t3coreapi:opcache@$1;
}
location ~ ^/m/typo3/reference-coreapi/(main|13.4|12.4)/en-us/Administration/Installation/ProductionSettings.html {
   return 301 https://docs.typo3.org/permalink/t3coreapi:production-settings@$1;
}
location ~ ^/m/typo3/reference-coreapi/(main|13.4|12.4)/en-us/Administration/Installation/Install.html {
   return 301 https://docs.typo3.org/permalink/t3coreapi:installation-index@$1;
}
location ~ ^/m/typo3/reference-coreapi/(main|13.4|12.4)/en-us/Administration/Installation/LegacyInstallation.html {
   return 301 https://docs.typo3.org/permalink/t3coreapi:classic-installation$1;
}
location ~ ^/m/typo3/reference-coreapi/(main|13.4|12.4)/en-us/Administration/Installation/Deployment/Index.html {
   return 301 https://docs.typo3.org/permalink/t3coreapi:deployment@$1;
}
location ~ ^/m/typo3/reference-coreapi/(main|13.4|12.4)/en-us/Administration/Installation/EnvironmentConfiguration.html {
   return 301 https://docs.typo3.org/permalink/t3coreapi:environment-configuration@$1;
}
location ~ ^/m/typo3/reference-coreapi/(main|13.4|12.4)/en-us/Administration/Installation/ReleaseIntegrity.html {
   return 301 https://docs.typo3.org/permalink/t3coreapi:release-integrity@$1;
}
location ~ ^/m/typo3/tutorial-getting-started/(main|13.4|12.4)/en-us/Installation/ReleaseIntegrity.html {
   return 301 https://docs.typo3.org/permalink/t3coreapi:release-integrity@$1;
}
location ~ ^/m/typo3/tutorial-getting-started/(main|13.4|12.4)/en-us/Installation/(Deployer/Index|Surf/Index|Magallanes/Index).html {
   return 301 https://docs.typo3.org/permalink/t3coreapi:deployment-deployer$1;
}
location ~ ^/m/typo3/tutorial-getting-started/(main|13.4|12.4)/en-us/Installation/(Surf/Index|Magallanes/Index).html {
   return 301 https://docs.typo3.org/permalink/t3coreapi:deployment-tools@$1;
}
location ~ ^/m/typo3/tutorial-getting-started/(main|13.4|12.4)/en-us/en-us/Troubleshooting/(TYPO3|SystemModules|PHP|Database).html {
   return 303 https://docs.typo3.org/m/typo3/reference-coreapi/$1/en-us/Administration/Troubleshooting/$2.html;
}

# Rewrite moved pages from Fluid Standalone documentation overhaul (2025)
location ~ ^/other/typo3fluid/fluid/(main|4\.0)/en-us/Usage/Syntax\.html {
    return 303 /other/typo3fluid/fluid/$1/en-us/Syntax/Index.html;
}
location ~ ^/other/typo3fluid/fluid/(main|4\.0)/en-us/Development/(Index|Decisions)\.html {
    return 303 /other/typo3fluid/fluid/$1/en-us/Extending/Index.html;
}
location ~ ^/other/typo3fluid/fluid/(main|4\.0)/en-us/Development/CreatingViewHelpers\.html {
    return 303 /other/typo3fluid/fluid/$1/en-us/Extending/ViewHelpers.html;
}
location ~ ^/other/typo3fluid/fluid/(main|4\.0)/en-us/Development/Expressions\.html {
    return 303 /other/typo3fluid/fluid/$1/en-us/Extending/ExpressionNodes.html;
}
location ~ ^/other/typo3fluid/fluid/(main|4\.0)/en-us/Development/Implementation\.html {
    return 303 /other/typo3fluid/fluid/$1/en-us/Integrating/Index.html;
}
location ~ ^/other/typo3fluid/fluid/(main|4\.0)/en-us/Usage/RunningExamples\.html {
    return 303 /other/typo3fluid/fluid/$1/en-us/Internals/RunningExamples.html;
}

# TYPO3 release integrity guide as requestes by ohader
# https://github.com/TYPO3-Documentation/TYPO3CMS-Guide-Installation/pull/82
location ~ ^/typo3cms/drafts/github/TYPO3Incubator/InfrastructureGuide/Releases(?:$|/.*) {
    return 301 /permalink/t3coreapi:release-integrity;
}

# Last redirect in chain - redirect all extension URLs that didn't match before to TER.
# This is a prefix-based redirect, this is executed after all regex-based redirects in dynamic_redirects.conf.
location /typo3cms/extensions/ {
    rewrite ^/typo3cms/extensions/([^/]+)(/stable/?)? https://extensions.typo3.org/extension/$1 redirect;
}

#################################
# Third-party extension redirects
#################################

# aoepeople/crawler to tomasnorre/crawler
location ~ ^/p/aoepeople/crawler/(.*) {
    return 301 /p/tomasnorre/crawler/$2;
}

# eventnews
location ~ ^/typo3cms/extensions/eventnews/(.*) {
    return 301 /p/georgringer/eventnews/main/en-us/$2;
}

# contentblocks/content-blocks to friendsoftypo3/content-blocks
location ~ ^/p/contentblocks/content-blocks/(.*) {
    return 301 /p/friendsoftypo3/content-blocks/main/en-us/$2;
}
